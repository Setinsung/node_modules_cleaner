# 查询指定路径下的所有node_modules路径
function Find-TargetDirectories {
    param (
        [Parameter(Mandatory = $true)]
        [string]$Path
    )
    $directories = Get-ChildItem -Path $Path -Directory
    foreach ($directory in $directories) {
        if ($directory.Name -eq "node_modules") {
            Write-Output $directory.FullName
        }
        else {
            Find-TargetDirectories -Path $directory.FullName
        }
    }
}

# 打印所有路径和大小
$dirs = Find-TargetDirectories -Path (Get-Location)
Write-Host "The following path will be deleted:"
$fso = New-Object -ComObject Scripting.FileSystemObject
$dirs | ForEach-Object {
    $dir_size = ($fso.GetFolder($_).Size/1MB).ToString("F2") + "MB"
    Write-Host "Size: $dir_size Path: $_"
}

# 用户确认
$continue = Read-Host "Do you want to continue with the deletion operation? (Y/N)"
if ($continue -eq "N") {
    Write-Host "The deletion operation has been canceled."
    exit
}

# 开始删除
$start_time = (Get-Date)
foreach ($dir in $dirs) {
    Remove-Item -Path $dir -Recurse -Force
}
$total_time = (New-TimeSpan $start_time).totalseconds.ToString("F2")
Write-Host "Delete completed, time taken: $total_time s"